<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JPA & HIBERNATE</title>
    <link rel="stylesheet" href="../../../css/style.css">
</head>

<body>

<section class="container">
    <h1 class="no_mb">JPA & HIBERNATE</h1>
    <div class="after-h1">Вопросы для собеседования</div>
    <div class="breadcrumbs">
        <p><a href="../../../">главная</a></p>
        <p><a href="..">Questions</a></p>
        <p>JPA</p>
    </div>
    <h3 class="no_mt">Воросы:</h3>
    <ul class="menu">
        <li><a href="#q1">Что такое: ORM, JPA, Hibernate?</a></li>
        <li><a href="#q2">Что такое EntityManager? Его функции?</a></li>
    </ul>
</section>

<section class="container" id="q1">
    <h1><a href="#">Что такое: ORM, JPA, Hibernate?</a></h1>
    <div class="tab-1">
        <p><a href="#q1_orm">ORM</a></p>
        <p><a href="#q1_jpa">JPA</a></p>
        <p><a href="#q1_hibernate">Hibernate</a></p>
    </div>
    <hr class="mb10">

    <div id="q1_orm">
        <h3><a href="#q1">ORM</a></h3>
        <p class="no_mb main-mind">
            Object Relational Mapping (ORM)
            — это концепция/процесс преобразования данных из объектно-ориентированного языка в
            реляционные БД и наоборот.
        </p>
        <p class="example">Например, в Java это делается с помощью рефлексии и JDBC.</p>
        <p class="no_mb">
            <span class="accent-mono">JDBC (Java DataBase Connectivity)</span>
            — API для работы с реляционными (зависимыми) БД.
        </p>
        <p>
            Платформенно независимый промышленный стандарт взаимодействия Java-приложений с различными СУБД,
            реализованный в виде пакета java.sql, входящего в состав Java SE.
        </p>
        <p>

            Предоставляет методы для получения и
            обновления данных. Не зависит от конкретного типа базы. Библиотека, которая входит в стандартную библиотеу,
            содержит: набор классов и интерфейсов для работы с БД (для нас разработчиков api) + интерфейсы баз данных.
        </p>
        <p>
            JDBC реализует механизмы работы подключений к базе данных, создания запросов и обработки результатов.
        </p>

        <div>
            <h4>JDBC Архитектура</h4>
            <div class="image-box">
                <img class="image" src="./img/arch.png" alt="JDBC Архитектура">
            </div>
        </div>

        <div>
            <h4>JDBC Сущности</h4>
            <ol class="marker-mono">
                <li>
                    <p class="mb10">
                        <span class="accent-mono">Connection</span>
                        (класс) объект которого отвечает за соединение с базой и режим работы с ней.
                    </p>
                </li>
                <li>
                    <p>
                        <span class="accent-mono">Statement</span>
                        (объект для оператора JDBC) используется для отправки SQL-оператора на сервер баз данных.
                    </p>
                    <p class="mb10">
                        Объект для оператора связан с объектом Connection и является объектом, обрабатывающим
                        взаимодействие между приложением и сервером баз данных.
                    </p>
                    <div class="tab-1">
                        <p>Можно:</p>
                        <ul>
                            <li>что-то поменять Update statement (create, delete, insert) в базе;</li>
                            <li>что-то запросить Query statement (select) из базы;</li>
                        </ul>
                    </div>
                    <div class="tab-1">
                        <p>Виды Statement-ов:</p>
                        <ul>
                            <li>
                                <span class="accent-mono">Statement (обычный)</span>
                                передаем в него либо Update, либо Query;
                            </li>
                            <li>
                                <span class="accent-mono">PreparedStatement</span>
                                - возможность сделать некий шаблон запроса, подставлять в него к-то значения и
                                использовать его;
                            </li>
                            <li>
                                <span class="accent-mono">CallableStatement</span>
                                - предоставляет возможность вызова хранимой процедуры,
                                расположенной на сервере, из Java™-приложения.
                            </li>
                        </ul>
                    </div>
                </li>
                <li>
                    <span class="accent-mono">ResultSet</span>
                    - объект с результатом запроса, который вернула база. Внутри него таблица.
                </li>
            </ol>
        </div>

        <div>
            <h4>Рефлексия</h4>
            <div class="tab-1">
                <p class="no_mb">это API, который позволяет:</p>
                <ul>
                    <li>
                        получать информацию о переменных, методах внутри класса, о самом классе, его конструкторах,
                        реализованных интерфейсах и т.д.;
                    </li>
                    <li>получать новый экземпляр класса;</li>
                    <li>получать доступ ко всем переменным и методам, в том числе <span>приватным</span>;</li>
                    <li>преобразовывать классы одного типа в другой (cast);</li>
                    <li>делать все это <span>во время исполнения программы</span> (динамически, в <span>Runtime</span>).
                    </li>
                </ul>
            </div>
            <p>
                В Java есть специальный класс по имени Class. Поэтому его и называют классом класса.
                С помощью него осуществляется работа с рефлексией.
            </p>
        </div>

    </div>

    <hr>
    <div id="q1_jpa">
        <h3><a href="#q1">JPA</a></h3>
        <p class="main-mind">
            Java Persistence API (JPA)
            - это спецификация (стандарт, технология), обеспечивающая объектно-реляционное отображение простых
            JAVA-объектов (Plain Old Java Object - POJO) и предоставляющая универсальный API для сохранения, получения и
            управления такими объектами.
        </p>
        <p>
            Сам JPA не умеет ни сохранять, ни управлять объектами, JPA только определяет правила игры: как должен
            действовать каждый провайдер (Hibernate, EclipseLink, OJB, Torque и т.д.), реализующий стандарт JPA. Для
            этого JPA определяет интерфейсы, которые должны быть реализованы провайдерами. Также JPA определяет правила,
            как должны описываться метаданные отображения и как должны работать провайдеры. Каждый провайдер обязан
            реализовывать всё из JPA, определяя стандартное получение, сохранение и управление объектами. Помимо этого,
            провайдеры могут добавлять свои личные классы и интерфейсы, расширяя функционал JPA.
        </p>
        <p class="bold no_mb">JPA </p>
        <div class="tab-1">
            <ul>
                <li>API в пакете javax.persistance (набор интерфейсов EntityManager, Query, EntityTransaction);</li>
                <li>JPQL - объектный язык запросов (запросы выполняются к объектам);</li>
                <li>Metadata (аннотации или xml)</li>
            </ul>
        </div>
    </div>

    <hr>
    <div id="q1_hibernate">
        <h3><a href="#q1">HIBERNATE</a></h3>
        <p>
            <span class="accent-mono">Hibernate</span>
            - это провайдер, реализующий спецификацию JPA. Hibernate полностью реализует JPA плюс добавляет функционал в
            виде своих классов и интерфейсов, расширяя свои возможности по работе с сущностями и БД.
        </p>
    </div>

    <a class="button button--top" href="#"></a>

</section>

<section class="container" id="q2">
    <h1>Что такое EntityManager?<br>Какие функции он выполняет?</h1>

    <div id="q2_entity_manager">
        <h3>EntityManager</h3>
        <p class="main-mind">
            Это интерфейс JPA, используемый для взаимодействия с персистентным контекстом.
        </p>
        <p class="no_mb">
            EntityManager описывает API для всех основных операций над Entity, а также для получения данных и других
            сущностей JPA.
        </p>
        <p>По сути - главный API для работы с JPA.</p>
        <p>
            <span class="accent-mono">Персистентный контекст</span>
            - это набор экземпляров сущностей, загруженных из БД или только что созданных.
        </p>
        <p>
            Персистентный контекст является своего рода кэшем данных в рамках транзакции
            - это и есть кэш первого уровня.
        </p>
        <p>
            Внутри контекста персистентности происходит управление экземплярами сущностей и их жизненным циклом.
        </p>
        <p>
            EntityManager автоматически сохраняет в БД все изменения, сделанные в его персистентном контексте,
            в момент коммита транзакции, либо при явном вызове метода <span class="code-word">flush()</span>.
        </p>
        <p>
            Один или несколько EntityManager образуют или могут образовать
            <span class="accent-mono">persistence context</span>.
        </p>
        <p>
            Если проводить аналогию с обычным JDBC, то EntityManagerFactory будет аналогом DataSource,
            а EntityManager аналогом Connection.
        </p>
        <p>
            Создание EntityManagerFactory довольно дорогая операция, поэтому обычно её создают один раз
            и на всё приложение.
            А чаще всего не создают сами, а делегируют это фреймворку, такому как Spring, например.
        </p>
        <p>
            Интерфейс Session из Hibernate представлен в JPA как раз интерфейсом EntityManager.
        </p>

        <table class="list" aria-label="">
            <thead>
            <tr>
                <th>JPA</th>
                <th>JDBC (по аналогии)</th>
                <th>Hibernate</th>
            <tr>
            </thead>
            <tr>
                <td>EntityManagerFactory</td>
                <td>DataSource</td>
                <td>SessionFactory</td>
            </tr>
            <tr>
                <td>EntityManager</td>
                <td>Connection</td>
                <td>Session</td>
            </tr>
            <tr>
                <td>JPQL</td>
                <td></td>
                <td>HQL</td>
            </tr>
        </table>

    </div>

    <div id="q2_entity_manager_function">
        <h3>Основные функции EntityManager</h3>
        <ol>
            <li>
                <p>Операции над Entity:</p>
                <ul>
                    <li><span class="accent-mono">persist</span> (добавление Entity под управление JPA)</li>
                    <li><span class="accent-mono">merge</span> (изменение)</li>
                    <li><span class="accent-mono">remove</span> (удаление)</li>
                    <li><span class="accent-mono">refresh</span> (обновление данных)</li>
                    <li><span class="accent-mono">detach</span> (удаление из-под управления контекста персистентности)
                    </li>
                    <li><span class="accent-mono">lock</span> (блокирование Entity от изменений в других thread)</li>
                </ul>
            </li>
            <li>
                <p>Получение данных:</p>
                <ul>
                    <li><span class="accent-mono">find</span> (поиск и получение Entity)</li>
                    <li><span class="accent-mono">createQuery</span></li>
                    <li><span class="accent-mono">createNamedQuery</span></li>
                    <li><span class="accent-mono">createNativeQuery</span></li>
                    <li><span class="accent-mono">contains</span></li>
                    <li><span class="accent-mono">createNamedStoredProcedureQuery</span></li>
                    <li><span class="accent-mono">createStoredProcedureQuery</span></li>
                </ul>
            </li>
            <li>
                <p>Получение других сущностей JPA</p>
                <ul>
                    <li><span class="accent-mono">getTransaction</span></li>
                    <li><span class="accent-mono">getEntityManagerFactory,</span></li>
                    <li><span class="accent-mono">getCriteriaBuilder</span></li>
                    <li><span class="accent-mono">getMetamodel</span></li>
                    <li><span class="accent-mono">getDelegate</span></li>
                </ul>
            </li>
            <li>
                <p>Работа с EntityGraph</p>
                <ul>
                    <li><span class="accent-mono">createEntityGraph</span></li>
                    <li><span class="accent-mono">getEntityGraph</span></li>
                </ul>
            </li>
            <li>
                <p>Общие операции</p>
                <ul>
                    <li><span class="accent-mono">close</span></li>
                    <li><span class="accent-mono">isOpen</span></li>
                    <li><span class="accent-mono">getProperties</span></li>
                    <li><span class="accent-mono">setProperty</span></li>
                    <li><span class="accent-mono">clear</span></li>
                </ul>
            </li>
        </ol>
        <p class="main-mind">
            Объекты EntityManager не являются потокобезопасными.
        </p>
        <p>
            Это означает, что каждый поток должен получить свой экземпляр EntityManager,
            поработать с ним и закрыть его в конце.
        </p>

    </div>

    <a href="#" class="button button--top"></a>
</section>

<footer>
    <div class="footer__text"><a href="https://t.me/java40plus" title="Мой блог в телеграм">
        Алексей Маслов, 2021-2023
    </a></div>
</footer>

</body>

</html>